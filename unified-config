# Unified Sway/i3 Configuration
# Set the desktop environment variable
set $de sway
set $msg swaymsg
set $exec_prefix exec

exec ~/set_once.sh

# Sway-specific environment setup
if ($de == "sway") {
    # Environment variables
    exec export XDG_CURRENT_DESKTOP=sway
    exec export XDG_SESSION_DESKTOP=sway
    exec export XDG_SESSION_TYPE=wayland

    # import variables from systemd for UI elements to display correctly
    exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
    exec dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP

    # Update systemd and dbus with the environment
    exec dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE
    exec systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE
}

if ($de == "i3") {
    set $msg i3-msg
    set $exec_prefix exec --no-startup-id
}

# Theme issue. Force dark theme
exec systemctl --user set-environment GTK_THEME=Arc-Dark
exec systemctl --user set-environment GTK2_RC_FILES=/usr/share/themes/Arc-Dark/gtk-2.0/gtkrc
exec systemctl --user set-environment QT_STYLE_OVERRIDE=Arc-Dark

# Configure gsettings (needed for some apps that ignore env vars)
exec_always {
    gsettings set org.gnome.desktop.interface gtk-theme 'Arc-Dark'
    gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
}


# Theme issue. Force dark theme
exec systemctl --user set-environment GTK_THEME=Arc-Dark
exec systemctl --user set-environment GTK2_RC_FILES=/usr/share/themes/Arc-Dark/gtk-2.0/gtkrc
exec systemctl --user set-environment QT_STYLE_OVERRIDE=Arc-Dark

# Configure gsettings (needed for some apps that ignore env vars)
exec_always {
    gsettings set org.gnome.desktop.interface gtk-theme 'Arc-Dark'
    gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
}

# Set environment variables for Qt themes
set $QT_QPA_PLATFORMTHEME qt5ct

if ($de == "sway") {
    include ~/.screenlayout.sway

    input "type:keyboard" {
        xkb_layout "us,us"
        xkb_variant "dvorak,"

        # Alt+Shift toggle
        # xkb_options "grp:alt_shift_toggle,caps:hyper"     

        # Right Alt+Shift toggle
        # xkb_options "grp:ralt_shift_toggle,caps:hyper"    

        # Scroll Lock key
        xkb_options "grp:sclk_toggle,caps:hyper"            

        # Right Windows/Super key
        # xkb_options "grp:rwin_toggle,caps:hyper"          
    }

    # sets display scaling to 1 for all displays
    output * scale 1
}

font pango: Noto Sans Regular 10
# exec_always "setxkbmap -layout us -variant ,dvorak,phonetic -option grp:alt_shift_toggle"

# set leader key to hyper
set $mod Mod3

# set other environment variables
set $terminal_client alacritty

set $i3config $HOME/.config/$de
set $i3scripts $i3config/scripts

workspace_layout default

#border indicator on windows:
default_border pixel 1
default_floating_border pixel 1
if ($de == "i3") {
    new_window pixel 1
}

# thin borders
hide_edge_borders both

# Make workspaces follow your focus between screens
workspace_auto_back_and_forth no
focus_follows_mouse yes

# Set inner/outer gaps
if ($de == "sway") {
    smart_gaps on
}
gaps inner 6
gaps outer 3

# show window title bars (not officially supported with i3gaps)
# default_border normal

# window title alignment
#title_align center

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# switch/iterate between workspaces
bindsym $mod+Tab workspace next
bindsym $mod+Shift+Tab workspace prev

# Add a binding to move workspaces between outputs (screens)
bindsym $mod+Shift+n move workspace to output right
# bindsym $mod+Shift+p move workspace to output left

# Focus right and left screens
bindsym $mod+n focus output right
# bindsym $mod+p focus output left

# switch to workspace - bring workspace to current screen
bindcode $mod+10       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 1
bindcode $mod+11       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 2
bindcode $mod+12       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 3
bindcode $mod+13       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 4
bindcode $mod+14       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 5
bindcode $mod+15       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 6
bindcode $mod+16       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 7
bindcode $mod+17       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 8
bindcode $mod+18       exec ~/.config/$de/scripts/force_workspace_current_screen.sh 9

# move focused container to workspace
bindcode $mod+Shift+10 move container to workspace 1
bindcode $mod+Shift+11 move container to workspace 2
bindcode $mod+Shift+12 move container to workspace 3
bindcode $mod+Shift+13 move container to workspace 4
bindcode $mod+Shift+14 move container to workspace 5
bindcode $mod+Shift+15 move container to workspace 6
bindcode $mod+Shift+16 move container to workspace 7
bindcode $mod+Shift+17 move container to workspace 8
bindcode $mod+Shift+18 move container to workspace 9

######################################
# keybindings for different actions: #
######################################

# start a terminal
# bindsym $mod+Return exec xfce4-terminal
bindsym $mod+Return exec $terminal_client
# for emergencies
bindsym Mod4+Return exec $terminal_client

# kill focused window
bindsym $mod+q kill

# Kill all windows in current workspace
# bindsym $mod+Shift+q exec "swaymsg '[workspace=__focused__] kill'"
bindsym $mod+Shift+q exec "$msg '[workspace=__focused__] kill'"

if ($de == "sway") {
    # Additional Sway workspace management mode
    bindsym $mod+Shift+q mode "rm_workspace"

    # resize window
    mode "rm_workspace" {
        bindsym $mod+q exec "$msg '[workspace=__focused__] kill'" , mode "default"
        bindsym $mod+Shift+q exec ~/.config/$de/scripts/organise-desktop.sh | tee /tmp/test.log , mode "default"

        bindsym 1 exec "$msg '[workspace=1] kill'" , mode "default"
        bindsym 2 exec "$msg '[workspace=2] kill'" , mode "default"
        bindsym 3 exec "$msg '[workspace=3] kill'" , mode "default"
        bindsym 4 exec "$msg '[workspace=4] kill'" , mode "default"
        bindsym 5 exec "$msg '[workspace=5] kill'" , mode "default"
        bindsym 6 exec "$msg '[workspace=6] kill'" , mode "default"
        bindsym 7 exec "$msg '[workspace=7] kill'" , mode "default"
        bindsym 8 exec "$msg '[workspace=8] kill'" , mode "default"
        bindsym 9 exec "$msg '[workspace=9] kill'" , mode "default"

        # Exit mode
        bindsym Return mode "default"
        bindsym Escape mode "default"
    }
}

# Use M-c and M-v for copy/paste
if ($de == "sway") {
    bindsym Alt+c exec ~/.config/$de/scripts/send-copy.sh
    bindsym Alt+v exec ~/.config/$de/scripts/send-paste.sh

    # alt copy and paste keys if one hand is on the mouse
    bindsym Alt+j exec ~/.config/$de/scripts/send-copy.sh
    bindsym Alt+k exec ~/.config/$de/scripts/send-paste.sh
}

if ($de == "i3") {
    # Use M-c and M-v for copy/paste with xsel (xorg)
    bindsym Mod1+c $exec_prefix "xsel -p | xsel -b"
    bindsym Mod1+v $exec_prefix "xsel -b | xsel -p -i"
}

# Session management
if ($de == "sway") {
    # Terminate current user session (logout)
    # bindsym Ctrl+Mod1+q exec loginctl terminate-session $XDG_SESSION_ID
    # bindsym Ctrl+Mod1+q exec swaymsg exit
    bindsym Ctrl+Mod1+q exec ~/.config/$de/scripts/gracefully-terminate-session.sh
}

if ($de == "i3") {
    # exit-menu
    #TODO: Find out about power menu
    bindsym $mod+Shift+e $exec_prefix ~/.config/$de/scripts/powermenu

    # exit to lightdm login page
    bindsym Ctrl+Mod1+q $exec_prefix ~/.config/$de/scripts/lightdm-lock.sh
    # bindsym $mod+l $exec_prefix $i3scripts/lock
    # $exec_prefix xautolock -time 1 -locker $i3scripts/lock
}

# Screen lock/idle management
if ($de == "sway") {
    # Screen idle/lock management - 120 minutes timeout
    exec swayidle -w \
        timeout 7200 'swaymsg "output * power off"' \
        resume 'swaymsg "output * power on"' \
        before-sleep 'swaylock -f -c 000000'

    # Manual screen lock with custom config
    bindsym Ctrl+shift+q exec swaylock -f \
        --config "$HOME/.config/$de/.swaylock/config" \
        --screenshots \
        --ignore-empty-password \
        --daemonize \
        --indicator-caps-lock \
        --indicator \
        --clock \
        --timestr "%Hh %Mm %Ss" \
        --datestr "%b-%d-%Y" \
        --show-failed-attempts \
        --indicator-idle-visible
}

if ($de == "i3") {
    # lock with solid color:
    # $exec_prefix xset s on && xset s blank
}

# theme manager
if ($de == "i3") {
    # Set environment variables for Qt themes
    $exec_prefix export QT_QPA_PLATFORMTHEME=qt5ct
    # Start theme services
    $exec_prefix xfsettingsd
}

# Combined action: reload i3 config, restart i3, and apply xmodmap
if ($de == "sway") {
    bindsym Mod4+Shift+r exec "$msg reload"
    bindsym $mod+Shift+r exec "$msg reload"
}

if ($de == "i3") {
    bindsym Mod4+Shift+r $exec_prefix "$msg reload && $msg restart && /usr/local/bin/apply_xmodmap.sh"
    bindsym $mod+Shift+r $exec_prefix "$msg reload && $msg restart && /usr/local/bin/apply_xmodmap.sh"
}

#TODO: Useful but need to fix wofi/rofi

# keybinding in fancy application menu (automated):
bindsym $mod+F1 exec ~/.config/$de/scripts/keyhint-2

if ($de == "i3") {
    # Backlight control
    #bindsym XF86MonBrightnessUp $exec_prefix xbacklight +10 && notify-send "Brightness - $(xbacklight -get | cut -d '.' -f 1)%"
    #bindsym XF86MonBrightnessDown $exec_prefix xbacklight -10 && notify-send "Brightness - $(xbacklight -get | cut -d '.' -f 1)%"
    # Backlight setting using dunst osc
    bindsym XF86MonBrightnessUp $exec_prefix ~/.config/$de/scripts/volume_brightness.sh brightness_up
    bindsym XF86MonBrightnessDown $exec_prefix ~/.config/$de/scripts/volume_brightness.sh brightness_down
}

# change focus
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# alternatively, you can use the cursor keys:
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Enter resize mode
bindsym $mod+r mode "resize"

# resize window
mode "resize" {
    # Resize with hjkl (vim-like)
    bindsym h resize grow width 10 px or 10 ppt
    bindsym j resize shrink height 10 px or 10 ppt
    bindsym k resize grow height 10 px or 10 ppt
    bindsym l resize shrink width 10 px or 10 ppt

    # Or use arrow keys
    bindsym Left resize grow width 10 px or 10 ppt
    bindsym Down resize shrink height 10 px or 10 ppt
    bindsym Up resize grow height 10 px or 10 ppt
    bindsym Right resize shrink width 10 px or 10 ppt

    # Exit resize mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+r mode "default"
}

# split in horizontal orientation
bindsym $mod+v split h
# split in vertical orientation
bindsym $mod+s split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

#NOTE: stacking is not useful. You can achieve the same thing with tabbed mode and there is a plugin to find window

# bindsym $mod+s layout stacking
bindsym $mod+a focus parent
bindsym $mod+Shift+a focus child

bindsym $mod+g layout tabbed
bindsym $mod+Shift+g [workspace=__focused__] layout tabbed
bindsym $mod+e layout toggle split

# Doesn't work well when switching to tabbed mode
# autotiling script
# https://github.com/nwg-piotr/autotiling
# `yay -S autotiling 
# exec_always autotiling

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

# focus the parent container
# I do not use this
# bindsym $mod+a focus parent

# open new empty workspace
# bindsym $mod+Shift+n exec ~/.config/$de/scripts/empty_workspace

# Multimedia Keys
if ($de == "sway") {
    exec avizo-service &

    # Volume controls
    bindsym --locked XF86AudioRaiseVolume exec volumectl -u up
    bindsym --locked XF86AudioLowerVolume exec volumectl -u down  
    bindsym --locked XF86AudioMute exec volumectl toggle-mute

    # Brightness controls
    bindsym --locked XF86MonBrightnessUp exec lightctl up
    bindsym --locked XF86MonBrightnessDown exec lightctl down
}

if ($de == "i3") {
    # volume
    # use meta keys without showing osc
    #bindsym XF86AudioRaiseVolume $exec_prefix amixer -D pulse sset Master 5%+ && pkill -RTMIN+1 i3blocks
    #bindsym XF86AudioLowerVolume $exec_prefix amixer -D pulse sset Master 5%- && pkill -RTMIN+1 i3blocks
    # use meta keys showing osc using dunst
    bindsym XF86AudioRaiseVolume $exec_prefix ~/.config/$de/scripts/volume_brightness.sh volume_up
    bindsym XF86AudioLowerVolume $exec_prefix ~/.config/$de/scripts/volume_brightness.sh volume_down

    # gradular volume control
    bindsym $mod+XF86AudioRaiseVolume $exec_prefix amixer -D pulse sset Master 1%+ && pkill -RTMIN+1 i3blocks
    bindsym $mod+XF86AudioLowerVolume $exec_prefix amixer -D pulse sset Master 1%- && pkill -RTMIN+1 i3blocks

    # mute
    #bindsym XF86AudioMute $exec_prefix amixer sset Master toggle && killall -USR1 i3blocks
    # use meta keys showing osc using dunst
    bindsym XF86AudioMute $exec_prefix ~/.config/$de/scripts/volume_brightness.sh volume_mute

    # mic mute toggle
    bindsym XF86AudioMicMute exec amixer sset Capture toggle

    # audio control
    bindsym XF86AudioPlay $exec_prefix playerctl play-pause 
    # Above line will also work for pausing
    bindsym XF86AudioNext $exec_prefix playerctl next
    bindsym XF86AudioPrev $exec_prefix playerctl previous

    # Redirect sound to headphones
    # bindsym $mod+p $exec_prefix /usr/local/bin/switch-audio-port
}

# Acme mouse buttons (WIP)
if ($de == "sway") {
    bindsym --whole-window BTN_SIDE exec ~/.config/$de/scripts/acme.sh "BTN_SIDE"
    bindsym --whole-window BTN_EXTRA exec ~/.config/$de/scripts/acme.sh "BTN_EXTRA"
}

## App shortcuts
if ($de == "sway") {
    # Enter Chrome mode
    bindsym $mod+c mode "chrome"

    mode "chrome" {
        # Default profile
        bindsym c exec /opt/chrome/chrome, mode "default"
        
        # Profiles 1-9
        bindsym 0 exec /opt/google/chrome/chrome --profile-directory="Default"   --restore-last-session, mode "default"
        bindsym 1 exec /opt/google/chrome/chrome --profile-directory="Profile 1" --restore-last-session, mode "default"
        bindsym 2 exec /opt/google/chrome/chrome --profile-directory="Profile 2" --restore-last-session, mode "default"
        bindsym 3 exec /opt/google/chrome/chrome --profile-directory="Profile 3" --restore-last-session, mode "default"
        bindsym 4 exec /opt/google/chrome/chrome --profile-directory="Profile 4" --restore-last-session, mode "default"
        bindsym 5 exec /opt/google/chrome/chrome --profile-directory="Profile 5" --restore-last-session, mode "default"
        bindsym 6 exec /opt/google/chrome/chrome --profile-directory="Profile 6" --restore-last-session, mode "default"
        bindsym 7 exec /opt/google/chrome/chrome --profile-directory="Profile 7" --restore-last-session, mode "default"
        bindsym 8 exec /opt/google/chrome/chrome --profile-directory="Profile 8" --restore-last-session, mode "default"
        bindsym 9 exec /opt/google/chrome/chrome --profile-directory="Profile 9" --restore-last-session, mode "default"
        
        # Exit mode
        bindsym Escape mode "default"
    }
}

if ($de == "i3") {
    bindsym $mod+c $exec_prefix /opt/chrome/chrome 
    # bindsym $mod+z $exec_prefix /usr/bin/thunar
}

# Screenshots
if ($de == "sway") {
    # Full-screen screenshot (Print key) - saves to file and clipboard
    bindsym Print exec grim /tmp/screenshot.png && \
        wl-copy --type image/png < /tmp/screenshot.png && \
        mv /tmp/screenshot.png ~/Pictures/.screenshots/$(date +"%Y-%m-%d-%T")-screenshot.png && \
        notify-send "Screenshot saved"

    # Selection screenshot ($mod+Shift+d) - saves to file and clipboard
    bindsym $mod+Shift+d exec grim -g "$(slurp)" /tmp/screenshot.png && \
        wl-copy --type image/png < /tmp/screenshot.png && \
        mv /tmp/screenshot.png ~/Pictures/.screenshots/$(date +"%Y-%m-%d-%T")-screenshot.png && \
        notify-send "Screenshot selection saved"
}

if ($de == "i3") {
    # Full-screen screenshot (Print key) - saves to file and clipboard
    bindsym Print $exec_prefix \
        scrot '/tmp/screenshot.png' \
        && cat /tmp/screenshot.png | xclip -selection clipboard -t image/png \
        && mv /tmp/screenshot.png ~/Pictures/.screenshots/$(date +"%Y-%m-%d-%T")-screenshot.png \
        && notify-send "Screenshot saved to file and clipboard"

    # Selection screenshot ($mod+Shift+d) - saves to file and clipboard
    bindsym $mod+Shift+d $exec_prefix \
        maim -s '/tmp/screenshot.png' \
        && cat /tmp/screenshot.png | xclip -selection clipboard -t image/png \
        && mv /tmp/screenshot.png ~/Pictures/.screenshots/$(date +"%Y-%m-%d-%T")-screenshot.png \
        && notify-send "Screenshot saved to file and clipboard"
}

# Power Profiles menu switcher (rofi)
# bindsym $mod+Shift+p $exec_prefix ~/.config/$de/scripts/power-profiles

# configuration for workspace behaviour: #
##########################################

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"

# bind program to workspace and focus to them on startup:
if ($de == "i3") {
    assign [class="alacritty"] $ws1

    # automatic set focus new window if it opens on another workspace than the current:
    for_window [class=alacritty] focus
}

##############
# compositor #
##############

if ($de == "i3") {
    #NOTE: To make the windows semi transparent but I don't use wallpapers

    # transparency
    # uncomment one of them to be used
    # options could need changes, related to used GPU and drivers.
    # to find the right setting consult the archwiki or ask at the forum.
    #
    # xcompmgr: https://wiki.archlinux.org/title/Xcompmgr
    # manpage: https://man.archlinux.org/man/xcompmgr.1.en
    # install xcompmgr package to use it (yay -S xcompmgr)
    #$exec_prefix xcompmgr -C -n &
    # or an more specialized config like this:
    #$exec_prefix xcompmgr -c -C -t-5 -l-5 -r4.2 -o.55 &
    #
    # or:
    #
    # picom: https://wiki.archlinux.org/title/Picom
    # manpage: https://man.archlinux.org/man/picom.1.en
    # The default configuration is available in /etc/xdg/picom.conf 
    # For modifications, it can be copied to ~/.config/picom/picom.conf or ~/.config/picom.conf
    # install picom package (yay -S picom)
    # start using default config 
    #exec_always --no-startup-id picom -b
    #$exec_prefix picom --config ~/.config/picom/picom.conf

    #
    # for custom config:
    #exec_always --no-startup-id picom --config  ~/.config/picom.conf
}

#############################################
# autostart applications/services on login: #
#############################################

if ($de == "i3") {
    #get auth work with polkit-gnome
    $exec_prefix /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

    # dex execute .desktop files + apps using /etc/xdg/autostart.
    # when second to i3 a DE is installed or mixed usage of i3 + xfce4 or GNOME
    # in this cases better disable dex and use manual starting apps using xdg/autostart
    # if enabled you should comment welcome app.
    # https://github.com/jceb/dex
    #$exec_prefix dex -a -s /etc/xdg/autostart/:~/.config/autostart/
    $exec_prefix dex --autostart --environment i3
}

# num lock activated
#exec numlockx on

# configure multiple keyboard layouts and hotkey to switch (Alt+CAPSLOCK in this example)
#exec setxkbmap -layout 'us,sk' -variant altgr-intl,qwerty -option 'grp:alt_caps_toggle'

# use arandr to setup displays and save the file as monitor:
if ($de == "sway") {
    exec ~/.screenlayout/00-default
}

if ($de == "i3") {
    $exec_prefix ~/.screenlayout/00-default.sh
}

# set wallpaper
if ($de == "sway") {
    # output * bg "#000000" solid_color
    output * bg ~/wallpaper.jpg fill #000000

    # Image options
    # output * bg ~/wallpaper.jpg fill
    # output * bg ~/wallpaper.jpg fit  
    # output * bg ~/wallpaper.jpg stretch
    # output * bg ~/wallpaper.jpg center
    # output * bg ~/wallpaper.jpg tile
}

if ($de == "i3") {
    # $exec_prefix sleep 2 && nitrogen --restore
    # $exec_prefix sleep 1 && feh --bg-fill /usr/share/endeavouros/backgrounds/endeavouros-wallpaper.png
    $exec_prefix sleep 1 && hsetroot -solid "#000000"

    # set powersavings for display:
    $exec_prefix xset s 480 dpms 600 600 600

    # disable power saving (for example if using xscreensaver)
    #$exec_prefix xset -dpms
}

#NOTE: I realise auto-locks are not useful

# use xautolock to use autosuspend rules for mobile devices
# https://wiki.archlinux.org/title/Session_lock#xautolock
# $exec_prefix xautolock -time 60 -notify 30 -notifier "notify-send 'Locking screen in 30 seconds'" -locker "i3lock" --suspend
# $exec_prefix xautolock -time 60 -notify 30 -notifier "notify-send 'Locking screen in 30 seconds'" -locker "i3lock" -killer "systemctl suspend" -killtime 65

# Desktop notifications
if ($de == "sway") {
    # exec dunst --config ~/.config/$de/.dunst/dunstrc -print | tee -a ~/.logs/dunst
    # exec mako -c ~/.config/$de/.mako/config
    exec mako
}

if ($de == "i3") {
    $exec_prefix dbus-launch /usr/bin/dunst --config ~/.config/$de/.dunst/dunstrc -print | tee -a ~/.logs/dunst
    # $exec_prefix /usr/bin/dunst --config ~/.config/$de/.dunst/dunstrc -print | tee -a ~/.logs/dunst
}

#WARN: This doens not work with tabbed mode

# autotiling script
# https://github.com/nwg-piotr/autotiling
# `yay -S autotiling 
# exec_always --no-startup-id autotiling

###############
# system tray #
###############
# if you do not use dex: exec dex --autostart --environment i3
# you need to have tray apps started manually one by one:

# start blueman app for managing bluetooth devices from tray:
if ($de == "sway") {
    exec blueman-tray
    exec blueman-applet
}

if ($de == "i3") {
    $exec_prefix blueman-tray
}

# networkmanager-applet
exec nm-applet

# clipboard management
if ($de == "sway") {
    # wl-paste applet
    exec wl-paste --watch cliphist store
}

if ($de == "i3") {
    # clipman-applet
    $exec_prefix xfce4-clipman
}

##################
# floating rules #
##################

# set floating (nontiling) for apps needing it
for_window [app_id="yad" instance="yad"] floating enable
for_window [app_id="galculator" instance="galculator"] floating enable
for_window [app_id="blueberry.py" instance="blueberry.py"] floating enable

for_window [class="Yad" instance="yad"] floating enable
for_window [class="Galculator" instance="galculator"] floating enable
for_window [class="Blueberry.py" instance="blueberry.py"] floating enable

# set floating (nontiling) for special apps
for_window [app_id="Xsane" instance="xsane"] floating enable
for_window [app_id="Pavucontrol" instance="pavucontrol"] floating enable
for_window [app_id="qt5ct" instance="qt5ct"] floating enable
for_window [app_id="Blueberry.py" instance="blueberry.py"] floating enable
for_window [app_id="Bluetooth-sendto" instance="bluetooth-sendto"] floating enable
for_window [app_id="Pamac-manager"] floating enable

for_window [class="xsane" instance="xsane"] floating enable
for_window [class="pavucontrol" instance="pavucontrol"] floating enable
for_window [class="qt5ct" instance="qt5ct"] floating enable
for_window [class="blueberry.py" instance="blueberry.py"] floating enable
for_window [class="bluetooth-sendto" instance="bluetooth-sendto"] floating enable
for_window [class="pamac-manager"] floating enable

for_window [window_role="About"] floating enable

# set border of floating window
for_window [app_id="urxvt"] border pixel 1
for_window [class="urxvt"] border pixel 1

# set size of floating window
#for_window [window_role="(?i)GtkFileChooserDialog"] resize set 640 480 #to set size of file choose dialog
#for_window [app_id=".*"] resize set 640 480 #to change size of all floating windows 

# set position of floating window
#for_window [app_id=".*"] move position center
#for_window [class=".*"] move position center

######################################
# color settings for bar and windows #
######################################

# Define colors variables:
set $darkbluetrans	#08052be6
set $darkblue		#08052b
set $lightblue		#5294e2
set $urgentred		#e53935
set $white		#ffffff
set $black		#000000
set $purple		#e345ff
set $darkgrey		#383c4a
set $grey		#b0b5bd
set $mediumgrey		#8b8b8b
set $yellowbrown	#e1b700

# define colors for windows:
#class		        	border		bground		text		indicator	child_border
client.focused		    	$lightblue	$darkblue	$white		$mediumgrey	$mediumgrey
client.unfocused	    	$darkblue	$darkblue	$grey		$darkgrey	$darkgrey
client.focused_inactive		$darkblue	$darkblue	$grey		$black		$black
client.urgent		    	$urgentred	$urgentred	$white		$yellowbrown	$yellowbrown

# Bar configuration
if ($de == "sway") {
    exec_always "pkill waybar; sleep 0.1; waybar -c ~/.config/$de/.waybar/config -s ~/.config/$de/.waybar/style.css"
}

if ($de == "i3") {
    ############################################
    # bar settings (input comes from i3blocks) #
    ############################################

    # Start i3bar to display a workspace bar
    # (plus the system information i3status finds out, if available)
    bar {
            font pango: Noto Sans Regular 10
            status_command i3blocks -c ~/.config/$de/i3blocks.conf
            position bottom
    #	    	i3bar_command i3bar --transparency
    # it could be that you have no primary display set: set one (xrandr --output <output> --primary)
    # reference: https://i3wm.org/docs/userguide.html#_tray_output
                #tray_output primary
                tray_padding 0

    # When strip_workspace_numbers is set to yes,
    # any workspace that has a name of the form
    # "[n][:][NAME]" will display only the name.
    # strip_workspace_numbers yes
    strip_workspace_name no

                colors {
                separator          $purple
                background         $darkgrey
                statusline         $white
    #                          		border 		        bg		txt		indicator
            focused_workspace	$mediumgrey	   	$grey		$darkgrey	$purple
            active_workspace	$lightblue      	$mediumgrey	$darkgrey	$purple
            inactive_workspace	$darkgrey   		$darkgrey	$grey		$purple
            urgent_workspace	$urgentred	    	$urgentred	$white		$purple
        }
    }

    # you can add different bars for multidisplay setups on each display:
    # set output HDMI-0 to the display you want the bar, --transparency can be set.
    # Transparency needs rgba color codes to be used where the last two letters are the transparency factor see here:
    # https://gist.github.com/lopspower/03fb1cc0ac9f32ef38f4
    # #08052be6 --> e6=90%

    # bar {
    #	font pango: Noto Sans Regular 10
    #	status_command i3blocks -c ~/.config/$de/i3blocks-2.conf
    #	i3bar_command i3bar --transparency
    #	output HDMI-0
    #	position bottom
    #
    # When strip_workspace_numbers is set to yes,
    # any workspace that has a name of the form
    # "[n][:][NAME]" will display only the name.
    #strip_workspace_numbers yes
    ##strip_workspace_name no
    #
    #	colors {
    #		separator          $purple
    #		background         $darkbluetrans
    #        	statusline         $white
    #					border		bg		txt		indicator
    #		focused_workspace	$lighterblue	$lighterblue	$darkblue	$purple
    #		active_workspace	$lightdblue	$lightdblue	$darkblue	$purple
    #		inactive_workspace	$darkblue	$darkblue	$lightdblue	$purple
    #		urgent_workspace	$urgentred	$urgentred	$white		$purple
    #	}
    #}
}

#####################################
# Application menu handled by launcher: #
#####################################

if ($de == "sway") {
    ## wofi bindings fancy application menu ($mod+d /F9 optional disabled)
    # bindsym $mod+d exec wofi --show drun
    bindsym $mod+d exec wofi --show drun --conf ~/.config/$de/.wofi/config
    # bindsym $mod+d exec rofi -show drun -display-drun "Apps: " -drun-display-format "{name} [{exec}]"
    # bindsym $mod+d exec rofi -modi drun -show drun

    ## wofi bindings for window menu ($mod+t /F10 optional disabled)
    bindsym $mod+t exec wofi -show window

    #bindsym F10 exec wofi -show window \
    #		-config ~/.config/$de/.wofi/wofidmenu.rasi

    ## wofi bindings to manage clipboard (install wofi-greenclip from the AUR)

    #exec greenclip daemon>/dev/null
    #bindsym $mod+c exec wofi -modi "clipboard:greenclip print" -show clipboard \
    #		-config ~/.config/$de/.wofi/wofidmenu.rasi
}

if ($de == "i3") {
    #####################################
    # Application menu handled by rofi: #
    #####################################

    ## rofi bindings fancy application menu ($mod+d /F9 optional disabled)
    bindsym $mod+d $exec_prefix rofi -modi drun -show drun

    #bindsym F9 $exec_prefix rofi -modi drun -show drun \
    #		-config ~/.config/$de/.rofi/rofidmenu.rasi

    ## rofi bindings for window menu ($mod+t /F10 optional disabled)

    bindsym $mod+t $exec_prefix rofi -show window

    #bindsym F10 $exec_prefix rofi -show window \
    #		-config ~/.config/$de/.rofi/rofidmenu.rasi

    ## rofi bindings to manage clipboard (install rofi-greenclip from the AUR)

    #$exec_prefix greenclip daemon>/dev/null
    #bindsym $mod+c $exec_prefix rofi -modi "clipboard:greenclip print" -show clipboard \
    #		-config ~/.config/$de/.rofi/rofidmenu.rasi
}

#####################################
# Mouse/pointer control             #
#####################################

if ($de == "sway") {
    # Enter warpd mode
    bindsym $mod+semicolon mode "warpd"

    mode "warpd" {
        bindsym h exec warpd --hint --config ~/.config/$de/.warpd/config; mode "default"
        bindsym shift+h exec warpd --hint2 --config ~/.config/$de/.warpd/config; mode "default" 
        bindsym g exec warpd --grid --config ~/.config/$de/.warpd/config; mode "default"
        bindsym c exec warpd --normal --config ~/.config/$de/.warpd/config; mode "default"
        bindsym semicolon exec warpd --history --config ~/.config/$de/.warpd/config; mode "default"
        bindsym s exec warpd --screen --config ~/.config/$de/.warpd/config; mode "default"
        
        # *--oneshot*: When paired with one of the mode flags, exit warpd as soon as the mode is complete (i.e don't drop into normal mode). When used with normal mode, exit as soon as a mouse button is pressed (without pressing it). If no mode flag is specified, the default behaviour is the same as --normal --oneshot. Principally useful for scripting.
        # *-q*, *--query*: Consume a list of hints from stdin and print the result to stdout (in the form <x> <y> <hint>). Each line should have the form *<label> <x> <y>*. May be used in conjunction with --click.
        # *--drag*: Automatically start a drag operation when paired with --normal.
        # *--move '<x> <y>'*: Move the pointer to the specified coordinates and exit.
        # *--click <button>*: Send a mouse click corresponding to the supplied button and exit. May be paired with --move or --oneshot (in which case the click will occur at the end of the selection).
        # *--record*: When used with --click, adds the click event to warpd's history.
        
        # Exit mode
        bindsym Escape mode "default"
        bindsym Return mode "default"
        bindsym q mode "default"
    }
}

if ($de == "i3") {
    # bindsym $mod+semicolon exec keynav -f ~/.config/$de/.keynav
    $exec_prefix keynav daemonize -f ~/.config/$de/.keynav
}

#####################################
# Command Mode                      #
#####################################
if ($de == "sway") {
    # bindsym $mod+colon exec echo "" | wofi --dmenu --prompt "sway:" | xargs -I {} swaymsg {}
    bindsym $mod+colon exec ~/.config/$de/scripts/sway-commander.sh
}

#########################################################3
# USER CONFIG
#########################################################3

# auto mount USB devices
exec udiskie --tray
